<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bouncing Balls Arena</title>
    <style>
      :root {
        --bg: radial-gradient(circle at 20% 20%, #111835, #050608 70%);
        --panel: rgba(255, 255, 255, 0.05);
        --accent: #ff9a44;
        --accent-strong: #fc6076;
        --text: #f5f5f5;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        background: var(--bg);
        color: var(--text);
        font-family: "Space Grotesk", system-ui, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1.5rem;
        padding: 2.5rem 1.5rem 3rem;
      }

      h1 {
        margin: 0;
        text-transform: uppercase;
        letter-spacing: 0.08em;
      }

      .card {
        width: min(960px, 100%);
        background: var(--panel);
        border: 1px solid rgba(255, 255, 255, 0.14);
        border-radius: 28px;
        padding: 1.75rem;
        backdrop-filter: blur(16px);
        box-shadow: 0 40px 70px rgba(0, 0, 0, 0.55);
        display: flex;
        flex-direction: column;
        gap: 1.25rem;
      }

      .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
      }

      button {
        flex: 1 1 180px;
        border: none;
        border-radius: 999px;
        padding: 0.85rem 1.25rem;
        font-size: 1rem;
        font-weight: 600;
        color: #040303;
        background: linear-gradient(
          120deg,
          var(--accent),
          var(--accent-strong)
        );
        cursor: pointer;
        transition: transform 160ms ease, box-shadow 160ms ease;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 14px 22px rgba(252, 96, 118, 0.35);
      }

      canvas {
        width: 100%;
        height: auto;
        border-radius: 24px;
        border: 1px solid rgba(255, 255, 255, 0.18);
        background: rgba(0, 0, 0, 0.35);
      }

      .hint {
        text-align: center;
        color: rgba(245, 245, 245, 0.7);
      }

      @media (max-width: 640px) {
        .controls {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <h1>Bouncing Balls Arena</h1>
    <div class="card">
      <div class="controls">
        <button id="spawnOne">Add Ball</button>
        <button id="spawnBurst">Add 5 Balls</button>
        <button id="clear">Reset Arena</button>
      </div>
      <canvas id="arena" width="900" height="520"></canvas>
      <div class="hint">
        Tip: click anywhere in the canvas to spawn a ball there.
      </div>
    </div>

    <script>
      const canvas = document.getElementById("arena");
      const ctx = canvas.getContext("2d");
      const balls = [];
      const minRadius = 12;
      const maxRadius = 26;
      const maxSpeed = 220;

      function rand(min, max) {
        return Math.random() * (max - min) + min;
      }

      function createBall(x, y) {
        const radius = rand(minRadius, maxRadius);
        const safeX = Math.min(
          Math.max(x ?? rand(radius, canvas.width - radius), radius),
          canvas.width - radius
        );
        const safeY = Math.min(
          Math.max(y ?? rand(radius, canvas.height - radius), radius),
          canvas.height - radius
        );

        balls.push({
          x: safeX,
          y: safeY,
          vx: rand(-maxSpeed, maxSpeed),
          vy: rand(-maxSpeed, maxSpeed),
          radius,
          color: `hsl(${Math.random() * 360}, 75%, 60%)`,
        });
      }

      function update(delta) {
        const width = canvas.width;
        const height = canvas.height;

        for (let i = 0; i < balls.length; i++) {
          const b = balls[i];
          b.x += b.vx * delta;
          b.y += b.vy * delta;

          if (b.x - b.radius < 0) {
            b.x = b.radius;
            b.vx *= -1;
          } else if (b.x + b.radius > width) {
            b.x = width - b.radius;
            b.vx *= -1;
          }

          if (b.y - b.radius < 0) {
            b.y = b.radius;
            b.vy *= -1;
          } else if (b.y + b.radius > height) {
            b.y = height - b.radius;
            b.vy *= -1;
          }
        }

        for (let i = 0; i < balls.length; i++) {
          for (let j = i + 1; j < balls.length; j++) {
            resolveCollision(balls[i], balls[j]);
          }
        }
      }

      function resolveCollision(a, b) {
        let dx = b.x - a.x;
        let dy = b.y - a.y;
        let dist = Math.hypot(dx, dy);
        const minDist = a.radius + b.radius;

        if (dist === 0) {
          dx = 0.01;
          dy = 0.01;
          dist = Math.hypot(dx, dy);
        }

        if (dist >= minDist) {
          return;
        }

        const nx = dx / dist;
        const ny = dy / dist;
        const overlap = minDist - dist;
        a.x -= nx * overlap * 0.5;
        a.y -= ny * overlap * 0.5;
        b.x += nx * overlap * 0.5;
        b.y += ny * overlap * 0.5;

        const tx = -ny;
        const ty = nx;
        const vAn = a.vx * nx + a.vy * ny;
        const vAt = a.vx * tx + a.vy * ty;
        const vBn = b.vx * nx + b.vy * ny;
        const vBt = b.vx * tx + b.vy * ty;

        a.vx = vBn * nx + vAt * tx;
        a.vy = vBn * ny + vAt * ty;
        b.vx = vAn * nx + vBt * tx;
        b.vy = vAn * ny + vBt * ty;
      }

      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        for (const ball of balls) {
          ctx.beginPath();
          ctx.fillStyle = ball.color;
          ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
          ctx.fill();
        }
      }

      let last = performance.now();
      function loop(now) {
        const delta = (now - last) / 1000;
        last = now;
        update(delta);
        draw();
        requestAnimationFrame(loop);
      }
      requestAnimationFrame(loop);

      document.getElementById("spawnOne").addEventListener("click", () => {
        createBall();
      });

      document.getElementById("spawnBurst").addEventListener("click", () => {
        for (let i = 0; i < 5; i++) {
          createBall();
        }
      });

      document.getElementById("clear").addEventListener("click", () => {
        balls.length = 0;
      });

      canvas.addEventListener("click", (event) => {
        const rect = canvas.getBoundingClientRect();
        const scaleX = canvas.width / rect.width;
        const scaleY = canvas.height / rect.height;
        const x = (event.clientX - rect.left) * scaleX;
        const y = (event.clientY - rect.top) * scaleY;
        createBall(x, y);
      });

      for (let i = 0; i < 6; i++) {
        createBall();
      }
    </script>
  </body>
</html>
